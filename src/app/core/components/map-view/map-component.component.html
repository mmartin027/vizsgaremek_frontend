<app-header></app-header>
<link href="https://unpkg.com/maplibre-gl@latest/dist/maplibre-gl.css" rel="stylesheet" />
<div class="map-layout-wrapper">
  
  <div class="cards-container">
  @for (spot of parkingSpots; track spot.id) {
    <app-parking-card
      [spot]="spot"
      (viewDetails)="handleViewDetails($event)">
    </app-parking-card>
  }
</div>
  <div class="map-container-relative">
    <div id="map" class="map-canvas"></div>

    <div class="loading-overlay" *ngIf="isLoading">
      <div class="spinner-container">
        <div class="spinner"></div>
        <p>Bet√∂lt√©s...</p>
      </div>
    </div>

    <div class="zone-card-container" *ngIf="selectedZone">
      <div class="floating-card">
        <button class="close-x" (click)="closeSidebar()">‚úï</button>
        
        <div class="image-wrapper">
          <img [src]="selectedZone.imageUrl || 'assets/no-image-parking.jpg'" class="card-img">
          <div class="status-badge" [ngClass]="selectedZone.availableSpaces > 0 ? 'available' : 'full'">
            {{ selectedZone.availableSpaces > 0 ? 'El√©rhet≈ë' : 'Tele' }}
          </div>
        </div>

        <div class="card-content">
          <div class="header-row">
            <h2>{{ selectedZone.name }}</h2>
            <span class="price-tag">{{ selectedZone.hourlyRate | number }} Ft/√≥</span>
          </div>
          <p class="address">üìç {{ selectedZone.address || 'C√≠m nem el√©rhet≈ë' }}</p>
          
          <div class="capacity-info">
            <div class="capacity-text">
              <span>Szabad: <b>{{ selectedZone.availableSpaces }}</b> / {{ selectedZone.capacity }}</span>
            </div>
            <div class="progress-bg">
              <div class="progress-fill" 
                   [style.width.%]="(selectedZone.availableSpaces / selectedZone.capacity) * 100"
                   [style.background-color]="getProgressBarColor()">
              </div>
            </div>

          </div>

          <button class="action-button" [disabled]="selectedZone.availableSpaces <= 0" (click)="onBook(selectedZone.id)">
            {{ selectedZone.availableSpaces > 0 ? 'R√©szletek & Foglal√°s' : 'Sajnos megtelt' }}
          </button>
        </div>
      </div>
    </div>
  </div>

</div>